

# Make a simple email
```{python}
from great_tables import GT
import os
from plotnine import ggplot, aes, geom_point, labs
import pandas as pd
import base64
from io import BytesIO
```

``` {python}

# Simple text
body_text = "<p>Hello, this is a test email with text, a plot, an image, and a table.</p>"

```

```{python}
# Simple plot with plotnine
df = pd.DataFrame({'x': [1, 2, 3], 'y': [3, 2, 1]})
p = ggplot(df, aes('x', 'y')) + geom_point() + labs(title="A Simple Plot")

plot_path = "img/plot.png"
p.save(plot_path, format='png')
```


```{python}
image_path = "img/sunset.jpeg"
```


```{python}
# Simple table with GT
table_df = pd.DataFrame({'A': [1, 2], 'B': [3, 4]})
gt = GT(table_df)
table_html = gt.as_raw_html()

table_html

```

```{python}
result_head = """
<meta charset="utf-8">
<title>Email Preview</title>
"""

# Wrap the email body in the HTML structure
email_body = f"""<!doctype html>
<html>
  <head>
{result_head}
  </head>
  <body>
{body_text + table_html}
  </body>
</html>"""

email_body

```

# send email with yagmail

The annoying bit with this is you have to write the plot to a file, you can't directly pass the bytes in.

The table is also a little mangled
```{python}
from dotenv import load_dotenv
load_dotenv()

import yagmail

password = os.environ["GMAIL_APP_PASSWORD"]
username = "jules.walzergoldfeld@gmail.com"

yag = yagmail.SMTP(username, password)
contents = [yagmail.raw(email_body), yagmail.inline(image_path), yagmail.inline(plot_path),]

yag.send(username, 'subject', contents)

```
