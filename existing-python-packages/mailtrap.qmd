

# Make a simple email
```{python}
from great_tables import GT
import os
from plotnine import ggplot, aes, geom_point, labs
import pandas as pd
import base64
from io import BytesIO
```

``` {python}

# Simple text
body_text = "<p>Hello, this is a test email with text, a plot, an image, and a table.</p>"

```

```{python}
# Simple plot with plotnine
df = pd.DataFrame({'x': [1, 2, 3], 'y': [3, 2, 1]})
p = ggplot(df, aes('x', 'y')) + geom_point() + labs(title="A Simple Plot")
buf = BytesIO()
p.save(buf, format='png')
buf.seek(0)

# Note base64 for this library
plot_base64 = base64.b64encode(buf.read()).decode('utf-8')

plot_html = '<img src="cid:plot-image" alt="plotnine plot"/><br>'

plot_html

```


```{python}
# Simple image (embed as base64)
image_path = "img/sunset.jpeg"

with open(image_path, "rb") as img_file:
    image_bytes = base64.b64encode(img_file.read()).decode('utf-8')
image_attachment = {
    "content": list(image_bytes),
    "filename": "photo.jpeg",
    "content_id": "photo-image"
}

image_html = '<img src="cid:photo-image" alt="placeholder image"/><br>'

image_html
```


```{python}
# Simple table with GT
table_df = pd.DataFrame({'A': [1, 2], 'B': [3, 4]})
gt = GT(table_df)
table_html = gt.as_raw_html()

table_html
```

```{python}
result_head = """
<meta charset="utf-8">
<title>Email Preview</title>
"""

# Wrap the email body in the HTML structure
email_body = f"""<!doctype html>
<html>
  <head>
{result_head}
  </head>
  <body>
{body_text + image_html + plot_html + table_html}
  </body>
</html>"""

email_body
```

```{python}
from dotenv import load_dotenv
load_dotenv()

import mailtrap as mt
from mailtrap import Attachment, Disposition, MailtrapClient

mail = mt.Mail(
    sender=mt.Address(email="mailtrap@demomailtrap.co", name="Mailtrap Test"),
    # have to send to this because this is my account
    to=[mt.Address(email="jules.walzergoldfeld@posit.co")],
    subject="You are awesome!",
    html=email_body,
    attachments=[
        Attachment(
            content=plot_base64,
            filename="placeholder.png",
            disposition=Disposition.ATTACHMENT, 
            mimetype="application/png",
            content_id="plot-image"
        ),
        Attachment(
            content=image_bytes,
            filename="placeholder2.png",
            disposition=Disposition.ATTACHMENT, 
            mimetype="application/png",
            content_id="photo-image"
        )
    ],
)

token = os.environ["MAILTRAP_TOKEN"]

client = MailtrapClient(token=token)

client.send(mail)
```
